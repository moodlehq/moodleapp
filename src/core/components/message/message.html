<div *ngIf="message()" class="message-box" (longPress)="copyMessage()"
     [class.has-user-data]="message()?.showUserData"
     [class.no-user-data]="!message()?.showUserData"
     [class.has-tail]="message()?.showTail"
     [class.no-tail]="!message()?.showTail"
     [@messageAnimation]="'in'">
    <div class="main">
        <!-- User data. -->
        <div class="message-user" *ngIf="message()?.showUserData" [@fadeIn]="'in'">
            <core-user-avatar slot="start" [user]="user" [courseId]="courseId" [linkProfile]="false" aria-hidden="true" />
            <div>{{ userFullname }}</div>
        </div>
        <div *ngIf="!message()?.showUserData" class="sr-only">
            {{ isMine()
            ? ('addon.messages.you' | translate)
            : userFullname }}
        </div>

        <div class="extra">
            <div class="message-time">
                @if (message()?.pending) {
                    <ion-icon name="fas-clock" [attr.aria-label]="'core.notsent' | translate" role="status" />
                } @else {
                    @if (message()?.deleted) {
                        <ion-icon name="fas-trash" aria-hidden="true" />
                        <span class="ion-text-wrap">{{ 'core.deletedoffline' | translate }}</span>
                    } @else {
                        {{ time() | coreFormatDate: 'strftimetime' }}
                    }
                }
            </div>

            @if (showDelete() && !message()?.deleted && message()?.delete !== false) {
                <ion-button fill="clear"  color="danger" animate.enter="slide-in-right-animation" animate.leave="slide-out-right-animation"
                    (click)="delete($event)" [ariaLabel]="'addon.messages.deletemessage' | translate" class="delete-button">
                    <ion-icon name="fas-trash" slot="icon-only" aria-hidden="true" />
                </ion-button>
            }
            @if (showDelete() && message()?.deleted) {
                <ion-button fill="clear" color="danger" animate.enter="slide-in-right-animation" animate.leave="slide-out-right-animation"
                    (click)="undoDelete($event)" [ariaLabel]="'core.restore' | translate" class="delete-button">
                    <ion-icon name="fas-rotate-left" slot="icon-only" aria-hidden="true" />
                </ion-button>
            }
        </div>

        @if (message()?.showTail) {
            <div class="tail"></div>
        }
    </div>
</div>
