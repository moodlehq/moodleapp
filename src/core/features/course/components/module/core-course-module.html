<ng-container *ngIf="module.handlerData && module.visibleoncoursepage !== 0">
    <!-- LABEL MODULES - Full content display, not clickable -->
    <div *ngIf="module.modname === 'label'" class="label-module" [class.item-dimmed]="module.visible === 0">
        <div class="label-content">
            <core-format-text [text]="module.handlerData.title" contextLevel="module"
                [contextInstanceId]="module.id" [courseId]="module.course" />
        </div>
    </div>

    <!-- ACTIVITY/RESOURCE MODULES - Compact clickable rows -->
    <div *ngIf="module.modname !== 'label'"
        class="activity-module core-course-module-handler {{module.handlerData.class}}"
        [class.clickable]="moduleHasView && module.handlerData.action && module.uservisible"
        [class.item-dimmed]="module.visible === 0 || module.uservisible === false"
        (click)="moduleClicked($event)"
        [id]="'core-course-module-' + module.id">

        <ng-container *ngIf="!module.handlerData.loading">
            <!-- Main row -->
            <div class="activity-row">
                <!-- Icon -->
                <div class="activity-icon">
                    <core-mod-icon *ngIf="module.handlerData.icon" [modicon]="module.handlerData.icon" [modname]="module.modname"
                        [componentId]="module.instance" [fallbackTranslation]="module.modplural" [purpose]="module.purpose"
                        [isBranded]="module.branded" />
                </div>

                <!-- Title & Info -->
                <div class="activity-info">
                    <span class="activity-title">
                        <core-format-text [text]="module.handlerData.title" contextLevel="module"
                            [contextInstanceId]="module.id" [courseId]="module.course" />
                    </span>

                    <!-- Status badges -->
                    <div class="activity-badges" *ngIf="module.visible === 0 || (module.visible !== 0 && module.isStealth)">
                        <ion-badge color="secondary" *ngIf="module.visible === 0">
                            <ion-icon name="far-eye-slash" aria-hidden="true" /> Hidden
                        </ion-badge>
                        <ion-badge color="secondary" *ngIf="module.visible !== 0 && module.isStealth">
                            <ion-icon name="fas-eye-low-vision" aria-hidden="true" /> Stealth
                        </ion-badge>
                    </div>
                </div>
            }

                <!-- Right side: completion + chevron -->
                <div class="activity-actions" *ngIf="module.uservisible !== false">
                    <core-course-module-completion *ngIf="hasCompletion && !showLegacyCompletion"
                        [completion]="module.completiondata" [moduleName]="module.name" [moduleId]="module.id"
                        [showCompletionConditions]="false" [showManualCompletion]="showManualCompletion"
                        (completionChanged)="completionChanged.emit($event)" />

                    <ion-icon name="chevron-forward" class="chevron" *ngIf="moduleHasView" aria-hidden="true" />
                </div>
            </div>

            <!-- Activity dates -->
            <div *ngIf="showActivityDates && module.dates?.length" class="activity-dates">
                <core-reminders-date *ngFor="let date of module.dates" [type]="date.id" [label]="date.label"
                    [time]="date.timestamp" [relativeTo]="date.relativeto" />
            </div>

            <!-- Description (expandable) -->
            <div *ngIf="module.description" class="activity-description">
                <core-format-text [text]="module.description" contextLevel="module"
                    [contextInstanceId]="module.id" [courseId]="module.course" />
            </div>

            <!-- Availability restrictions -->
            <div *ngIf="showAvailability && module.availabilityinfo" class="activity-availability">
                <ion-icon name="fas-lock" aria-hidden="true" />
                <core-format-text [text]="module.availabilityinfo" contextLevel="module"
                    [contextInstanceId]="module.id" [courseId]="module.course" />
            </div>

            <!-- Extra badges (file size, etc) -->
            <div *ngIf="showExtra && module.handlerData.extraBadge" class="activity-extra-badges"
                [innerHTML]="module.handlerData.extraBadge"></div>

            <!-- Last viewed indicator -->
            <div class="activity-last-viewed" *ngIf="isLastViewed">
                <ion-icon name="fas-eye" aria-hidden="true" />
                {{ 'core.course.lastaccessedactivity' | translate }}
            </div>
        </ng-container>

        <!-- Loading state -->
        <div *ngIf="module.handlerData.loading" class="activity-loading">
            <ion-spinner></ion-spinner>
        </div>
    </div>
</ng-container>
