---
phase: 02-custom-code-adaptation
plan: 06
type: code
wave: 2
depends_on: [02-01]
files_modified:
  - src/addons/block/timeline/components/timeline/timeline.ts
  - src/addons/block/timeline/components/timeline/addon-block-timeline.html
  - src/addons/block/timeline/components/timeline/timeline.scss
  - src/addons/block/myoverview/components/myoverview/myoverview.ts
  - src/addons/block/myoverview/components/myoverview/addon-block-myoverview.html
  - src/addons/block/myoverview/components/myoverview/myoverview.scss
autonomous: true

must_haves:
  truths:
    - "Timeline block compiles without TypeScript errors"
    - "My Overview block compiles without TypeScript errors"
    - "Timeline shows courses sorted by most urgent deadline first"
    - "Aspire filter options work (status filter, date filter)"
    - "Parent mentee context awareness works in timeline"
  artifacts:
    - path: "src/addons/block/timeline/components/timeline/timeline.ts"
      provides: "Timeline block with Aspire filters and mentee context"
      exports: ["AddonBlockTimelineComponent"]
    - path: "src/addons/block/myoverview/components/myoverview/myoverview.ts"
      provides: "My Overview block with card layout default"
      exports: ["AddonBlockMyOverviewComponent"]
  key_links:
    - from: "timeline.ts"
      to: "@/core/utils/rxjs"
      via: "formControlValue helper"
      pattern: "formControlValue"
---

<objective>
Fix timeline and myoverview block addons - these have significant import issues and code structure problems.

Purpose: Timeline is critical for showing upcoming deadlines (sorted by urgency for Aspire). My Overview shows course cards with Aspire-specific defaults.

Output: Block addons compile and display correctly with all Aspire customizations.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-custom-code-adaptation/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix timeline.ts imports and structure</name>
  <files>src/addons/block/timeline/components/timeline/timeline.ts</files>
  <action>
    This file has SIGNIFICANT issues identified in research. Fix in order:

    1. **Add missing RxJS imports**:
       ```typescript
       import { Observable, BehaviorSubject, Subject, of } from 'rxjs';
       import {
           catchError,
           combineLatest,
           distinctUntilChanged,
           map,
           mergeAll,
           share,
           tap
       } from 'rxjs/operators';
       ```

    2. **Add missing CoreLogger import**:
       ```typescript
       import { CoreLogger } from '@singletons/logger';
       ```

    3. **Replace CoreDomUtils with CoreAlerts**:
       Current (if present): `CoreDomUtils.showErrorModalDefault(error, ...)`
       Change to:
       ```typescript
       import { CoreAlerts } from '@services/overlays/alerts';
       // Use: CoreAlerts.showError(error)
       ```

    4. **Add missing ICoreBlockComponent import**:
       ```typescript
       import { ICoreBlockComponent } from '@features/block/classes/block-component';
       ```

    5. **Add missing CoreSearchBoxComponent import** (used in imports array):
       ```typescript
       import { CoreSearchBoxComponent } from '@components/search-box/search-box';
       ```

    6. **Add missing formControlValue helper**:
       ```typescript
       import { formControlValue } from '@/core/utils/rxjs';
       ```

    7. **Add missing resolved helper**:
       ```typescript
       import { resolved } from '@/core/utils/rxjs';
       ```

    8. **Fix code structure issues** (lines ~330-470):
       The research noted incomplete/broken code with mixed async patterns.
       Look for unclosed functions, missing returns, or syntax errors.
       The initializeSections() method appears to have incomplete code.

    Preserve ALL Aspire customizations:
    - Default sort by courses: `AddonBlockTimelineSort.ByCourses`
    - Default filter 7 days: `AddonBlockTimelineFilter.Next7Days`
    - Status filter (All/Overdue/Done)
    - Date filter options
    - Courses sorted by most urgent deadline
    - Mentee context awareness (viewingAsMentee, checkMenteeContext)
  </action>
  <verify>
    Run: `npx tsc --noEmit src/addons/block/timeline/components/timeline/timeline.ts 2>&1 | head -40`
  </verify>
  <done>
    - All RxJS imports added
    - CoreLogger, CoreAlerts, CoreSearchBoxComponent imports added
    - formControlValue and resolved helpers imported
    - Code structure issues fixed
    - No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix myoverview.ts imports</name>
  <files>src/addons/block/myoverview/components/myoverview/myoverview.ts</files>
  <action>
    Fix the following import issues:

    1. **Add missing CoreCoursesCourseListItemComponent import** (used in imports array):
       ```typescript
       import { CoreCoursesCourseListItemComponent } from '@features/courses/components/course-list-item/course-list-item';
       ```

    2. **Check for CoreDomUtils deprecation**:
       If file uses CoreDomUtils, migrate to specific overlay services:
       - showErrorModalDefault -> CoreAlerts.showError()
       - showToast -> CoreToasts.show()

    3. **Verify CorePromiseUtils import** (if used):
       ```typescript
       import { CorePromiseUtils } from '@singletons/promise-utils';
       ```

    Preserve ALL Aspire customizations:
    - Default layout: 'card'
    - Default sort: 'timemodified'
    - Default filter: 'all' (show all courses)
    - Category filter for Aspire School
    - availableCategories array
  </action>
  <verify>
    Run: `npx tsc --noEmit src/addons/block/myoverview/components/myoverview/myoverview.ts 2>&1 | head -30`
  </verify>
  <done>
    - CoreCoursesCourseListItemComponent imported
    - CoreDomUtils calls migrated
    - Aspire defaults preserved (card layout, timemodified sort, all filter)
    - No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify block templates and SCSS</name>
  <files>
    src/addons/block/timeline/components/timeline/addon-block-timeline.html
    src/addons/block/timeline/components/timeline/timeline.scss
    src/addons/block/myoverview/components/myoverview/addon-block-myoverview.html
    src/addons/block/myoverview/components/myoverview/myoverview.scss
  </files>
  <action>
    1. **Verify timeline template**:
       - Filter controls match component properties
       - Events display correctly
       - core-search-box component is used

    2. **Verify myoverview template**:
       - Layout switch (card/list) works
       - Filter tabs match component properties
       - Course list items display correctly

    3. **Verify SCSS files**:
       - No deprecated syntax
       - Aspire styling customizations preserved

    No major changes expected if templates match components.
  </action>
  <verify>
    Templates should compile when parent components compile successfully.
  </verify>
  <done>
    - Templates match component classes
    - SCSS files are valid
    - Aspire UI customizations present
  </done>
</task>

</tasks>

<verification>
Run TypeScript check on block addons:
```bash
npx tsc --noEmit \
  src/addons/block/timeline/components/timeline/timeline.ts \
  src/addons/block/myoverview/components/myoverview/myoverview.ts \
  2>&1 | head -40
```

Check for RxJS imports in timeline:
```bash
grep -n "from 'rxjs'" src/addons/block/timeline/components/timeline/timeline.ts
grep -n "formControlValue\|resolved" src/addons/block/timeline/components/timeline/timeline.ts
```
</verification>

<success_criteria>
- BLK-01: Timeline customizations preserved (sort by urgency, status/date filters)
- BLK-02: Myoverview customizations preserved (card layout default, all courses)
- BLK-03: Block component imports updated
- BLK-04: Mentee context awareness works in timeline
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-custom-code-adaptation/02-06-SUMMARY.md`
</output>
