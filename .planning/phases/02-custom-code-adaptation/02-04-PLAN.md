---
phase: 02-custom-code-adaptation
plan: 04
type: code
wave: 2
depends_on: [02-01]
files_modified:
  - src/core/features/courses/pages/dashboard/dashboard.ts
  - src/core/features/courses/pages/dashboard/dashboard.html
  - src/core/features/courses/pages/dashboard/dashboard.scss
  - src/core/features/courses/components/course-list-item/course-list-item.ts
  - src/core/features/courses/services/courses.ts
autonomous: true

must_haves:
  truths:
    - "Dashboard compiles without TypeScript errors"
    - "Parent can see mentee cards and switch between children"
    - "Timeline block appears first (Aspire customization)"
    - "Search opens global search (not course search)"
    - "News scrolling function works"
  artifacts:
    - path: "src/core/features/courses/pages/dashboard/dashboard.ts"
      provides: "Dashboard page with parent view, timeline sorting"
      exports: ["CoreCoursesDashboardPage"]
    - path: "src/core/features/courses/services/courses.ts"
      provides: "Courses service"
  key_links:
    - from: "dashboard.ts"
      to: "@services/overlays/alerts"
      via: "CoreAlerts import"
      pattern: "CoreAlerts"
    - from: "dashboard.ts"
      to: "@singletons/promise-utils"
      via: "CorePromiseUtils import"
      pattern: "CorePromiseUtils"
---

<objective>
Fix dashboard.ts import issues and ensure parent/mentee dashboard view works correctly.

Purpose: Dashboard is the home page showing timeline and course overview. Parent features and Aspire customizations must be preserved.

Output: Dashboard compiles and displays correctly with all Aspire customizations.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-custom-code-adaptation/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix dashboard.ts imports</name>
  <files>src/core/features/courses/pages/dashboard/dashboard.ts</files>
  <action>
    Fix the following import issues identified in research:

    1. **Add CorePromiseUtils import** (used for ignoreErrors, allPromisesIgnoringErrors):
       The code uses `CorePromiseUtils.ignoreErrors()` and `CorePromiseUtils.allPromisesIgnoringErrors()`
       Add if not present:
       ```typescript
       import { CorePromiseUtils } from '@singletons/promise-utils';
       ```

    2. **Add CoreAlerts import** (used in loadContent error handling):
       The code uses `CoreAlerts.showError(error)`
       Add:
       ```typescript
       import { CoreAlerts } from '@services/overlays/alerts';
       ```

    3. **Add CoreToasts import** if showToast is used:
       Check if CoreDomUtils.showToast is used. If so, replace with:
       ```typescript
       import { CoreToasts } from '@services/overlays/toasts';
       // Old: CoreDomUtils.showToast('message')
       // New: CoreToasts.show({ message: 'message' })
       ```

    4. **Add CORE_BLOCKS_DASHBOARD_FALLBACK_BLOCKS constant** (used in loadFallbackBlocks):
       If code references this constant, add:
       ```typescript
       import { CORE_BLOCKS_DASHBOARD_FALLBACK_BLOCKS } from '@features/courses/constants';
       ```
       Or define it locally if it's not exported from constants.

    5. **Handle CoreDomUtils deprecation**:
       If CoreDomUtils is imported and used:
       - `CoreDomUtils.showToast()` -> `CoreToasts.show({ message: ... })`
       - `CoreDomUtils.showErrorModalDefault()` -> `CoreAlerts.showError()`
       - `CoreDomUtils.showErrorModal()` -> `CoreAlerts.showError()`

    Preserve ALL existing Aspire customizations:
    - Parent/mentee properties (isParent, hasChildren, mentees, selectedMenteeId)
    - Timeline block sorting (ensure timeline appears first)
    - Global search navigation (openSearch -> '/search')
    - News forum navigation (scrollToNews)
    - Mentee selection methods (selectMenteeAndNavigate, viewMenteeGrades, clearMenteeSelection)
    - getMenteeSequence, getSelectedMenteeName, getFirstWordOfFirstName helpers
  </action>
  <verify>
    Run: `npx tsc --noEmit src/core/features/courses/pages/dashboard/dashboard.ts 2>&1 | head -30`
  </verify>
  <done>
    - CorePromiseUtils imported from @singletons/promise-utils
    - CoreAlerts imported from @services/overlays/alerts
    - CoreDomUtils calls migrated to specific overlay services
    - All parent/mentee code preserved
    - No TypeScript import errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify dashboard templates and course-list-item</name>
  <files>
    src/core/features/courses/pages/dashboard/dashboard.html
    src/core/features/courses/components/course-list-item/course-list-item.ts
  </files>
  <action>
    1. **Verify dashboard.html template**:
       - Parent/mentee cards section exists
       - Timeline block reference
       - Search button links to global search
       - All bindings reference valid component properties

    2. **Verify course-list-item.ts**:
       - Check for any import path issues
       - Verify component decorator has proper imports array
       - Check for CoreSharedModule import if used

    No major changes expected if templates match components.
  </action>
  <verify>
    Run: `npx tsc --noEmit src/core/features/courses/components/course-list-item/course-list-item.ts 2>&1 | head -20`
  </verify>
  <done>
    - dashboard.html references valid component properties
    - course-list-item.ts compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify courses.ts service</name>
  <files>src/core/features/courses/services/courses.ts</files>
  <action>
    1. **Verify courses.ts service**:
       - Check import paths are up to date
       - Verify methods used by dashboard exist:
         - invalidateUserCourses()
         - invalidateAllUserCourses()
         - getUserCourses()
         - isSearchCoursesDisabledInSite()
         - isDownloadCourseDisabledInSite()
         - isDownloadCoursesDisabledInSite()
         - logView()

    2. **Check for deprecated imports**:
       If any old import paths are found, update to new overlay service paths.
  </action>
  <verify>
    Run: `npx tsc --noEmit src/core/features/courses/services/courses.ts 2>&1 | head -20`
  </verify>
  <done>
    - courses.ts service compiles without errors
    - All methods used by dashboard exist
  </done>
</task>

</tasks>

<verification>
Run TypeScript check on dashboard and courses:
```bash
npx tsc --noEmit \
  src/core/features/courses/pages/dashboard/dashboard.ts \
  src/core/features/courses/components/course-list-item/course-list-item.ts \
  src/core/features/courses/services/courses.ts \
  2>&1 | head -30
```

Verify CorePromiseUtils and CoreAlerts are properly imported:
```bash
grep -n "CorePromiseUtils\|CoreAlerts\|CoreDomUtils" src/core/features/courses/pages/dashboard/dashboard.ts
```
</verification>

<success_criteria>
- DSH-01: Aspire dashboard customizations preserved (parent view, timeline first)
- DSH-02: Course list item styling intact
- DSH-03: Courses service imports updated
- DSH-04: Dashboard template matches component class
- DSH-05: No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-custom-code-adaptation/02-04-SUMMARY.md`
</output>
