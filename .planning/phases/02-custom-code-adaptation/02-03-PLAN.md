---
phase: 02-custom-code-adaptation
plan: 03
type: code
wave: 2
depends_on: [02-01]
files_modified:
  - src/core/features/grades/pages/courses/courses.ts
  - src/core/features/grades/pages/courses/courses.html
  - src/core/features/grades/pages/courses/courses.scss
  - src/core/features/grades/pages/course/course.ts
  - src/core/features/grades/pages/course/course.html
  - src/core/features/grades/pages/course/course.scss
  - src/core/features/grades/services/grades.ts
autonomous: true

must_haves:
  truths:
    - "Grades pages compile without TypeScript errors"
    - "Parent can view mentee grades with card layout"
    - "Category grouping displays courses hierarchically"
    - "Grade color coding works (excellent/good/average/below/poor)"
  artifacts:
    - path: "src/core/features/grades/pages/courses/courses.ts"
      provides: "Grades courses page with parent view, category hierarchy"
      exports: ["CoreGradesCoursesPage"]
    - path: "src/core/features/grades/pages/course/course.ts"
      provides: "Individual course grades page"
  key_links:
    - from: "courses.ts"
      to: "@services/overlays/alerts"
      via: "CoreAlerts import"
      pattern: "CoreAlerts"
---

<objective>
Fix grades pages import issues and ensure parent/mentee grade viewing works correctly.

Purpose: Grades is a critical feature for parents viewing their children's academic progress. The card layout and category grouping are Aspire customizations.

Output: Grades pages compile and display correctly with all Aspire customizations.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-custom-code-adaptation/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix courses.ts imports</name>
  <files>src/core/features/grades/pages/courses/courses.ts</files>
  <action>
    Fix the following import issues:

    1. **Add missing CoreAlerts import** (used in fetchInitialCourses):
       The code uses `CoreAlerts.showError(error, { default: 'Error loading courses' });`
       Add:
       ```typescript
       import { CoreAlerts } from '@services/overlays/alerts';
       ```

    2. **Remove or update CoreDomUtils** (line ~26 if present):
       If file has:
       ```typescript
       import { CoreDomUtils } from '@services/utils/dom';
       ```
       This import may not be used if all showError calls are now CoreAlerts.
       Check if CoreDomUtils is still used elsewhere in the file. If not, remove it.

    3. **Verify CoreUtils import exists**:
       Used for `CoreUtils.ignoreErrors()` - should be:
       ```typescript
       import { CoreUtils } from '@services/utils/utils';
       ```

    Preserve ALL existing Aspire customizations:
    - isParentView, mentees, selectedMenteeId, menteeCourses
    - Category grouping (categoryTree, CategoryNode interface)
    - fetchAllMenteeCourses, fetchMenteeCoursesWithIndividualGrades
    - Grade helper methods (getSubjectIcon, getGradeColorClass, getOverallAverage)
  </action>
  <verify>
    Run: `npx tsc --noEmit src/core/features/grades/pages/courses/courses.ts 2>&1 | head -30`
  </verify>
  <done>
    - CoreAlerts imported from @services/overlays/alerts
    - All parent/mentee grade viewing code preserved
    - Category grouping code preserved
    - No TypeScript import errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix course.ts imports</name>
  <files>src/core/features/grades/pages/course/course.ts</files>
  <action>
    Fix the following import issues:

    1. **Add CoreSharedModule import** if component uses it in imports array:
       ```typescript
       import { CoreSharedModule } from '@/core/shared.module';
       ```

    2. **Add CoreAlerts import** if showError is used:
       ```typescript
       import { CoreAlerts } from '@services/overlays/alerts';
       ```

    3. **Verify all Angular imports** are present:
       - @angular/core decorators
       - Any signals used (viewChild, input, etc.)

    Check for and preserve any Aspire customizations in this file.
  </action>
  <verify>
    Run: `npx tsc --noEmit src/core/features/grades/pages/course/course.ts 2>&1 | head -30`
  </verify>
  <done>
    - All required imports present
    - No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify grades.ts service and templates</name>
  <files>
    src/core/features/grades/services/grades.ts
    src/core/features/grades/pages/courses/courses.html
    src/core/features/grades/pages/course/course.html
  </files>
  <action>
    1. **Verify grades.ts service**:
       - Check if any import path updates needed
       - Verify invalidateCoursesGradesData method exists (used in user-menu.ts)

    2. **Verify courses.html template**:
       - Parent view section with mentee cards
       - Category tree navigation
       - Grade color classes applied
       - All referenced methods exist in component

    3. **Verify course.html template**:
       - Grade items display
       - Any Aspire customizations
  </action>
  <verify>
    Read templates and verify all bindings reference valid component properties/methods.
  </verify>
  <done>
    - grades.ts service has proper exports
    - Templates match component classes
    - All Aspire UI customizations present
  </done>
</task>

</tasks>

<verification>
Run TypeScript check on grades pages:
```bash
npx tsc --noEmit \
  src/core/features/grades/pages/courses/courses.ts \
  src/core/features/grades/pages/course/course.ts \
  src/core/features/grades/services/grades.ts \
  2>&1 | head -30
```

Verify CoreAlerts is properly imported:
```bash
grep -n "CoreAlerts\|CoreDomUtils" src/core/features/grades/pages/courses/courses.ts
```
</verification>

<success_criteria>
- GRD-01: Grades card layout UI preserved (category grouping, grade colors)
- GRD-02: Grades service custom logic intact (invalidateCoursesGradesData)
- GRD-03: Import paths updated to new overlay services
- GRD-04: courses.html/course.html templates match component classes
- Parent can view each mentee's grades with proper UI
</success_criteria>

<output>
After completion, create `.planning/phases/02-custom-code-adaptation/02-03-SUMMARY.md`
</output>
