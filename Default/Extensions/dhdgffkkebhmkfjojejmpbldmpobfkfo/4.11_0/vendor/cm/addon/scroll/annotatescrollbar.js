'use strict';(function(h){"object"==typeof exports&&"object"==typeof module?h(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],h):h(CodeMirror)})(function(h){function m(a,d){function b(e){clearTimeout(c.doRedraw);c.doRedraw=setTimeout(function(){c.redraw()},e)}this.cm=a;this.options=d;this.buttonHeight=d.scrollButtonHeight||a.getOption("scrollButtonHeight");this.annotations=[];this.doRedraw=this.doUpdate=null;this.div=a.getWrapperElement().appendChild(document.createElement("div"));
this.div.style.cssText="position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none";this.computeScale();var c=this;a.on("refresh",this.resizeHandler=function(){clearTimeout(c.doUpdate);c.doUpdate=setTimeout(function(){c.computeScale()&&b(20)},100)});a.on("markerAdded",this.resizeHandler);a.on("markerCleared",this.resizeHandler);if(!1!==d.listenForChanges)a.on("change",this.changeHandler=function(){b(250)})}h.defineExtension("annotateScrollbar",function(a){"string"==typeof a&&(a={className:a});
return new m(this,a)});h.defineOption("scrollButtonHeight",0);m.prototype.computeScale=function(){var a=this.cm;a=(a.getWrapperElement().clientHeight-a.display.barHeight-2*this.buttonHeight)/a.getScrollerElement().scrollHeight;if(a!=this.hScale)return this.hScale=a,!0};m.prototype.update=function(a){this.annotations=a;this.redraw()};m.prototype.redraw=function(a){function d(n,u){p!=n.line&&(p=n.line,k=b.getLineHandle(p));return k.widgets&&k.widgets.length||v&&k.height>x?b.charCoords(n,"local")[u?
"top":"bottom"]:b.heightAtLine(k,"local")+(u?0:k.height)}!1!==a&&this.computeScale();var b=this.cm;a=this.hScale;var c=document.createDocumentFragment(),e=this.annotations,v=b.getOption("lineWrapping"),x=v&&1.5*b.defaultTextHeight(),p=null,k=null,w=b.lastLine();if(b.display.barWidth)for(var f=0,q;f<e.length;f++){var g=e[f];if(!(g.to.line>w)){for(var r=q||d(g.from,!0)*a,l=d(g.to,!1)*a;f<e.length-1&&!(e[f+1].to.line>w);){q=d(e[f+1].from,!0)*a;if(q>l+.9)break;g=e[++f];l=d(g.to,!1)*a}if(l!=r){l=Math.max(l-
r,3);var t=c.appendChild(document.createElement("div"));t.style.cssText="position: absolute; right: 0px; width: "+Math.max(b.display.barWidth-1,2)+"px; top: "+(r+this.buttonHeight)+"px; height: "+l+"px";t.className=this.options.className;g.id&&t.setAttribute("annotation-id",g.id)}}}this.div.textContent="";this.div.appendChild(c)};m.prototype.clear=function(){this.cm.off("refresh",this.resizeHandler);this.cm.off("markerAdded",this.resizeHandler);this.cm.off("markerCleared",this.resizeHandler);this.changeHandler&&
this.cm.off("change",this.changeHandler);this.div.parentNode.removeChild(this.div)}});
