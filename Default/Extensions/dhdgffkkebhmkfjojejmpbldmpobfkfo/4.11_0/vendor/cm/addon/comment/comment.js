'use strict';(function(r){"object"==typeof exports&&"object"==typeof module?r(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],r):r(CodeMirror)})(function(r){function I(b){b=b.search(w);return-1==b?0:b}function J(b,d,a){return/\bstring\b/.test(b.getTokenTypeAt(k(d.line,0)))&&!/^['"`]/.test(a)}function G(b,d){var a=b.getMode();return!1!==a.useInnerComments&&a.innerMode?b.getModeAt(d):a}var E={},w=/[^\s\u00a0]/,k=r.Pos;r.commands.toggleComment=function(b){b.toggleComment()};
r.defineExtension("toggleComment",function(b){b||(b=E);for(var d=Infinity,a=this.listSelections(),c=null,e=a.length-1;0<=e;e--){var g=a[e].from(),f=a[e].to();g.line>=d||(f.line>=d&&(f=k(d,0)),d=g.line,null==c?this.uncomment(g,f,b)?c="un":(this.lineComment(g,f,b),c="line"):"un"==c?this.uncomment(g,f,b):this.lineComment(g,f,b))}});r.defineExtension("lineComment",function(b,d,a){a||(a=E);var c=this,e=G(c,b),g=c.getLine(b.line);if(null!=g&&!J(c,b,g)){var f=a.lineComment||e.lineComment;if(!f||a.blockComment){if(a.blockCommentStart||
e.blockCommentStart)a.fullLines=!0,c.blockComment(b,d,a)}else{var m=Math.min(0!=d.ch||d.line==b.line?d.line+1:d.line,c.lastLine()+1),u=null==a.padding?" ":a.padding,l=a.commentBlankLines||b.line==d.line;c.operation(function(){if(a.indent){for(var q=null,h=b.line;h<m;++h){var p=c.getLine(h);p=p.slice(0,I(p));if(null==q||q.length>p.length)q=p}for(h=b.line;h<m;++h){p=c.getLine(h);var t=q.length;if(l||w.test(p))p.slice(0,t)!=q&&(t=I(p)),c.replaceRange(q+f+u,k(h,0),k(h,t))}}else for(h=b.line;h<m;++h)(l||
w.test(c.getLine(h)))&&c.replaceRange(f+u,k(h,0))})}}});r.defineExtension("blockComment",function(b,d,a){a||(a=E);var c=this,e=G(c,b),g=a.blockCommentStart||e.blockCommentStart,f=a.blockCommentEnd||e.blockCommentEnd;if(!g||!f)(a.lineComment||e.lineComment)&&0!=a.fullLines&&c.lineComment(b,d,a);else if(!/\bcomment\b/.test(c.getTokenTypeAt(k(b.line,0)))){var m=Math.min(d.line,c.lastLine());m!=b.line&&0==d.ch&&w.test(c.getLine(m))&&--m;var u=null==a.padding?" ":a.padding;b.line>m||c.operation(function(){if(0!=
a.fullLines){var l=w.test(c.getLine(m));c.replaceRange(u+f,k(m));c.replaceRange(g+u,k(b.line,0));var q=a.blockCommentLead||e.blockCommentLead;if(null!=q)for(var h=b.line+1;h<=m;++h)(h!=m||l)&&c.replaceRange(q+u,k(h,0))}else c.replaceRange(f,d),c.replaceRange(g,b)})}});r.defineExtension("uncomment",function(b,d,a){a||(a=E);var c=this,e=G(c,b),g=Math.min(0!=d.ch||d.line==b.line?d.line:d.line-1,c.lastLine()),f=Math.min(b.line,g),m=a.lineComment||e.lineComment,u=[],l=null==a.padding?" ":a.padding,q;a:if(m){for(var h=
f;h<=g;++h){var p=c.getLine(h),t=p.indexOf(m);-1<t&&!/comment/.test(c.getTokenTypeAt(k(h,t+1)))&&(t=-1);if(-1==t&&w.test(p))break a;if(-1<t&&w.test(p.slice(0,t)))break a;u.push(p)}c.operation(function(){for(var n=f;n<=g;++n){var A=u[n-f],x=A.indexOf(m),v=x+m.length;0>x||(A.slice(v,v+l.length)==l&&(v+=l.length),q=!0,c.replaceRange("",k(n,x),k(n,v)))}});if(q)return!0}var y=a.blockCommentStart||e.blockCommentStart,z=a.blockCommentEnd||e.blockCommentEnd;if(!y||!z)return!1;var H=a.blockCommentLead||e.blockCommentLead,
C=c.getLine(f),D=C.indexOf(y);if(-1==D)return!1;var F=g==f?C:c.getLine(g),B=F.indexOf(z,g==f?D+y.length:0);a=k(f,D+1);e=k(g,B+1);if(-1==B||!/comment/.test(c.getTokenTypeAt(a))||!/comment/.test(c.getTokenTypeAt(e))||-1<c.getRange(a,e,"\n").indexOf(z))return!1;e=C.lastIndexOf(y,b.ch);a=-1==e?-1:C.slice(0,b.ch).indexOf(z,e+y.length);if(-1!=e&&-1!=a&&a+z.length!=b.ch)return!1;a=F.indexOf(z,d.ch);b=F.slice(d.ch).lastIndexOf(y,a-d.ch);e=-1==a||-1==b?-1:d.ch+b;if(-1!=a&&-1!=e&&e!=d.ch)return!1;c.operation(function(){c.replaceRange("",
k(g,B-(l&&F.slice(B-l.length,B)==l?l.length:0)),k(g,B+z.length));var n=D+y.length;l&&C.slice(n,n+l.length)==l&&(n+=l.length);c.replaceRange("",k(f,D),k(f,n));if(H)for(n=f+1;n<=g;++n){var A=c.getLine(n),x=A.indexOf(H);if(-1!=x&&!w.test(A.slice(0,x))){var v=x+H.length;l&&A.slice(v,v+l.length)==l&&(v+=l.length);c.replaceRange("",k(n,x),k(n,v))}}});return!0})});
