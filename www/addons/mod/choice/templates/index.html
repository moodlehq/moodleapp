<ion-view>
    <ion-nav-title><mm-format-text watch="true">{{ title }}</mm-format-text></ion-nav-title>
    <ion-nav-buttons side="secondary">
        <mm-context-menu>
            <mm-context-menu-item priority="900" ng-if="moduleUrl" href="moduleUrl" content="'mm.core.openinbrowser' | translate" icon-action="'ion-share'"></mm-context-menu-item>
            <mm-context-menu-item priority="800" ng-if="description" content="'mm.core.moduleintro' | translate" action="expandDescription()" icon-action="'ion-arrow-right-c'"></mm-context-menu-item>
            <mm-context-menu-item priority="700" content="'mm.core.refresh' | translate" action="refreshChoice()" icon-action="refreshIcon" close-on-click="false" close-when-done="true"></mm-context-menu-item>
        </mm-context-menu>
    </ion-nav-buttons>
    <ion-content mm-state-class>
        <ion-refresher pulling-text="{{ 'mm.core.pulltorefresh' | translate }}" ng-if="choiceLoaded" on-refresh="refreshChoice()"></ion-refresher>
        <mm-loading hide-until="choiceLoaded">
            <mm-course-mod-description description="description" watch="true" component="{{component}}" component-id="{{componentId}}"></mm-course-mod-description>

            <!-- Activity availability messages -->
            <section class="card padding" ng-if="choice.timeopen != 0 && choice.timeopen > now">
                <p ng-if="options && options.length">{{ 'mma.mod_choice.previewonly' | translate:{$a: choice.openTimeReadable} }}</p>
                <p ng-if="!options || !options.length">{{ 'mma.mod_choice.notopenyet' | translate:{$a: choice.openTimeReadable} }}</p>
            </section>
            <section class="card padding" ng-if="choice.timeclose != 0 && choice.timeclose <= now">
                <p ng-if="options && options.length">{{ 'mma.mod_choice.yourselection' | translate }} <mm-format-text watch="true">{{options[0].text}}</mm-format-text></p>
                <p>{{ 'mma.mod_choice.expired' | translate:{$a: choice.closeTimeReadable} }}</p>
            </section>

            <!-- Choice done in offline but not synchronized -->
            <section class="card padding" ng-if="hasOffline">
                <p class="padding">{{ 'mm.core.hasdatatosync' | translate:{$a: moduleName} }}</p>
                <button class="button button-block icon-right ion-loop" ng-click="sync()">{{ 'mm.settings.synchronizenow' | translate }}</button>
            </section>

            <!-- Choice options -->
            <section class="card list" ng-if="options && options.length">
                <div ng-if="choice.allowmultiple">
                    <ion-checkbox ng-repeat="option in options" class="item-text-wrap item-checkbox-right" ng-model="option.checked" ng-disabled="option.disabled || !canEdit">
                        <p><mm-format-text watch="true">{{option.text}}</mm-format-text> <span ng-if="choice.limitanswers && option.countanswers >= option.maxanswers">{{ 'mma.mod_choice.full' | translate }}</span></p>
                    </ion-checkbox>
                </div>
                <div ng-if="!choice.allowmultiple">
                    <ion-radio ng-repeat="option in options" ng-model="selectedOption.id" ng-value="option.id" ng-disabled="option.disabled ||Â !canEdit">
                        <p><mm-format-text watch="true">{{option.text}}</mm-format-text> <span ng-if="choice.limitanswers && option.countanswers >= option.maxanswers">{{ 'mma.mod_choice.full' | translate }}</span></p>
                    </ion-radio>
                </div>
                <div class="item" ng-if="canEdit">
                    <button class="button button-block" ng-click="save()" ng-disabled="(!choice.allowmultiple && selectedOption.id == -1) || (choice.allowmultiple && (options | filter:{checked: true}).length == 0)">{{ 'mma.mod_choice.savemychoice' | translate }}</button>
                </div>
                <div class="item" ng-if="canDelete">
                    <button class="button button-block" ng-click="delete()">{{ 'mma.mod_choice.removemychoice' | translate }}</button>
                </div>
            </section>

            <!-- Choice results -->
            <section class="card text-center" ng-if="canSeeResults">
                <h3>{{ 'mma.mod_choice.responses' | translate }}</h3>

                <div class="padding" ng-if="hasOffline">
                    <p class="badge badge-inline badge-assertive padding">
                        <i class="icon ion-alert-circled padding"></i> {{ 'mma.mod_choice.resultsnotsynced' | translate }}
                    </p>
                </div>

                <canvas id="choiceResults" class="chart chart-pie" chart-data="data" chart-labels="labels" ></canvas>
            </section>
            <section class="card padding" ng-if="!canSeeResults">
                <p>{{ 'mma.mod_choice.noresultsviewable' | translate }}</p>
            </section>
        </mm-loading>
    </ion-content>
</ion-view>