{"version":3,"sources":["../../src/addon/mod/chat/pages/chat/chat.module.ts","../../src/addon/mod/chat/pages/chat/chat.ts"],"names":[],"mappings":"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","file":"95.js","sourcesContent":["// (C) Copyright 2015 Martin Dougiamas\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { CoreComponentsModule } from '@components/components.module';\nimport { CoreDirectivesModule } from '@directives/directives.module';\nimport { CorePipesModule } from '@pipes/pipes.module';\nimport { AddonModChatChatPage } from './chat';\n\n@NgModule({\n    declarations: [\n        AddonModChatChatPage,\n    ],\n    imports: [\n        CoreComponentsModule,\n        CoreDirectivesModule,\n        CorePipesModule,\n        IonicPageModule.forChild(AddonModChatChatPage),\n        TranslateModule.forChild()\n    ],\n})\nexport class AddonModChatChatPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/addon/mod/chat/pages/chat/chat.module.ts","// (C) Copyright 2015 Martin Dougiamas\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component, ViewChild, NgZone } from '@angular/core';\nimport { Content, IonicPage, ModalController, NavController, NavParams } from 'ionic-angular';\nimport { CoreAppProvider } from '@providers/app';\nimport { CoreEventsProvider } from '@providers/events';\nimport { CoreLoggerProvider } from '@providers/logger';\nimport { CoreSitesProvider } from '@providers/sites';\nimport { CoreDomUtilsProvider } from '@providers/utils/dom';\nimport { CoreTextUtilsProvider } from '@providers/utils/text';\nimport { AddonModChatProvider } from '../../providers/chat';\nimport { Network } from '@ionic-native/network';\nimport * as moment from 'moment';\n\n/**\n * Page that displays a chat session.\n */\n@IonicPage({ segment: 'addon-mod-chat-chat' })\n@Component({\n    selector: 'page-addon-mod-chat-chat',\n    templateUrl: 'chat.html',\n})\nexport class AddonModChatChatPage {\n    @ViewChild(Content) content: Content;\n\n    loaded = false;\n    title: string;\n    messages = [];\n    newMessage: string;\n    polling: any;\n    isOnline: boolean;\n    currentUserBeep: string;\n\n    protected logger;\n    protected courseId: number;\n    protected chatId: number;\n    protected sessionId: number;\n    protected lastTime = 0;\n    protected oldContentHeight = 0;\n    protected onlineObserver: any;\n    protected keyboardObserver: any;\n    protected viewDestroyed = false;\n    protected pollingRunning = false;\n\n    constructor(navParams: NavParams, logger: CoreLoggerProvider, network: Network,  zone: NgZone, private navCtrl: NavController,\n            private chatProvider: AddonModChatProvider, private appProvider: CoreAppProvider, sitesProvider: CoreSitesProvider,\n            private modalCtrl: ModalController, private domUtils: CoreDomUtilsProvider, private textUtils: CoreTextUtilsProvider,\n            private eventsProvider: CoreEventsProvider) {\n\n        this.chatId = navParams.get('chatId');\n        this.courseId = navParams.get('courseId');\n        this.title = navParams.get('title');\n        this.logger = logger.getInstance('AddonModChoiceChoicePage');\n        this.currentUserBeep = 'beep ' + sitesProvider.getCurrentSiteUserId();\n        this.isOnline = this.appProvider.isOnline();\n        this.onlineObserver = network.onchange().subscribe((online) => {\n            // Execute the callback in the Angular zone, so change detection doesn't stop working.\n            zone.run(() => {\n                this.isOnline = this.appProvider.isOnline();\n            });\n        });\n    }\n\n    /**\n     * View loaded.\n     */\n    ionViewDidLoad(): void {\n        this.loginUser().then(() => {\n            return this.fetchMessages().then(() => {\n                this.startPolling();\n            }).catch((error) => {\n                this.domUtils.showErrorModalDefault(error, 'addon.mod_chat.errorwhileretrievingmessages', true);\n                this.navCtrl.pop();\n            });\n        }).catch((error) => {\n            this.domUtils.showErrorModalDefault(error, 'addon.mod_chat.errorwhileconnecting', true);\n            this.navCtrl.pop();\n        }).finally(() => {\n            this.loaded = true;\n        });\n\n        // Recalculate footer position when keyboard is shown or hidden.\n        this.keyboardObserver = this.eventsProvider.on(CoreEventsProvider.KEYBOARD_CHANGE, (kbHeight) => {\n            this.content.resize();\n        });\n    }\n\n    /**\n     * Runs when the page has fully entered and is now the active page.\n     * This event will fire, whether it was the first load or a cached page.\n     */\n    ionViewDidEnter(): void {\n        this.startPolling();\n    }\n\n    /**\n     * Runs when the page is about to leave and no longer be the active page.\n     */\n    ionViewWillLeave(): void {\n        this.stopPolling();\n    }\n\n    /**\n     * Display the chat users modal.\n     */\n    showChatUsers(): void {\n        const modal = this.modalCtrl.create('AddonModChatUsersPage', {sessionId: this.sessionId});\n        modal.onDidDismiss((data) => {\n            if (data && data.talkTo) {\n                this.newMessage = `To ${data.talkTo}: `;\n            }\n            if (data && data.beepTo) {\n                this.sendMessage('', data.beepTo);\n            }\n        });\n        modal.present();\n    }\n\n    /**\n     * Convenience function to login the user.\n     *\n     * @return {Promise<any>} Resolved when done.\n     */\n    protected loginUser(): Promise<any> {\n        return this.chatProvider.loginUser(this.chatId).then((sessionId) => {\n            this.sessionId = sessionId;\n        });\n    }\n\n    /**\n     * Convenience function to fetch chat messages.\n     *\n     * @return {Promise<any>} Promise resolved when done.\n     */\n    protected fetchMessages(): Promise<any> {\n        return this.chatProvider.getLatestMessages(this.sessionId, this.lastTime).then((messagesInfo) => {\n            this.lastTime = messagesInfo.chatnewlasttime || 0;\n\n            return this.chatProvider.getMessagesUserData(messagesInfo.messages, this.courseId).then((messages) => {\n                this.messages = this.messages.concat(messages);\n                if (messages.length) {\n                    // New messages or beeps, scroll to bottom.\n                    setTimeout(() => this.scrollToBottom());\n                }\n            });\n        });\n    }\n\n    /**\n     * Start the polling to get chat messages periodically.\n     */\n    protected startPolling(): void {\n        // We already have the polling in place.\n        if (this.polling) {\n            return;\n        }\n\n        // Start polling.\n        this.polling = setInterval(() => {\n            this.fetchMessagesInterval().catch(() => {\n                // Ignore errors.\n            });\n        }, AddonModChatProvider.POLL_INTERVAL);\n    }\n\n    /**\n     * Stop polling for messages.\n     */\n    protected stopPolling(): void {\n        if (this.polling) {\n            this.logger.debug('Cancelling polling for messages');\n            clearInterval(this.polling);\n        }\n    }\n\n    /**\n     * Convenience function to be called every certain time to fetch chat messages.\n     *\n     * @return {Promise<any>} Promised resolved when done.\n     */\n    protected fetchMessagesInterval(): Promise<any> {\n        this.logger.debug('Polling for messages');\n        if (!this.isOnline || this.pollingRunning) {\n            // Obviously we cannot check for new messages when the app is offline.\n            return Promise.reject(null);\n        }\n\n        this.pollingRunning = true;\n\n        return this.fetchMessages().catch(() => {\n            // Try to login, it might have failed because the session expired.\n            return this.loginUser().then(() => {\n                return this.fetchMessages();\n            }).catch((error) => {\n                // Fail again. Stop polling if needed.\n                if (this.polling) {\n                    clearInterval(this.polling);\n                    this.polling = undefined;\n                }\n                this.domUtils.showErrorModalDefault(error, 'addon.mod_chat.errorwhileretrievingmessages', true);\n\n                return Promise.reject(null);\n            });\n        }).finally(() => {\n            this.pollingRunning = false;\n        });\n    }\n\n    /**\n     * Check if the date should be displayed between messages (when the day changes at midnight for example).\n     *\n     * @param  {any} message     New message object.\n     * @param  {any} prevMessage Previous message object.\n     * @return {boolean} True if messages are from diferent days, false othetwise.\n     */\n    showDate(message: any, prevMessage: any): boolean {\n        if (!prevMessage) {\n            return true;\n        }\n\n        // Check if day has changed.\n        return !moment(message.timestamp * 1000).isSame(prevMessage.timestamp * 1000, 'day');\n    }\n\n    /**\n     * Send a message to the chat.\n     *\n     * @param {string} text     Text of the nessage.\n     * @param {number} [beep=0] ID of the user to beep.\n     */\n    sendMessage(text: string, beep: number = 0): void {\n        if (!this.isOnline) {\n            // Silent error, the view should prevent this.\n            return;\n        } else if (beep === 0 && !text.trim()) {\n            // Silent error.\n            return;\n        }\n        text = this.textUtils.replaceNewLines(text, '<br>');\n\n        const modal = this.domUtils.showModalLoading('core.sending', true);\n        this.chatProvider.sendMessage(this.sessionId, text, beep).then(() => {\n            // Update messages to show the sent message.\n            this.fetchMessagesInterval().catch(() => {\n                // Ignore errors.\n            });\n        }).catch((error) => {\n            /* Only close the keyboard if an error happens, we want the user to be able to send multiple\n              messages without the keyboard being closed. */\n            this.appProvider.closeKeyboard();\n\n            this.domUtils.showErrorModalDefault(error, 'addon.mod_chat.errorwhilesendingmessage', true);\n        }).finally(() => {\n            modal.dismiss();\n        });\n    }\n\n    reconnect(): Promise<any> {\n        const modal = this.domUtils.showModalLoading();\n\n        // Call startPolling would take a while for the first execution, so we'll execute it manually to check if it works now.\n        return this.fetchMessagesInterval().then(() => {\n            // It works, start the polling again.\n            this.startPolling();\n        }).catch(() => {\n            // Ignore errors.\n        }).finally(() => {\n            modal.dismiss();\n        });\n    }\n\n    /**\n     * Scroll bottom when render has finished.\n     */\n    scrollToBottom(): void {\n        // Need a timeout to leave time to the view to be rendered.\n        setTimeout(() => {\n            if (!this.viewDestroyed) {\n                this.domUtils.scrollToBottom(this.content, 0);\n            }\n        });\n    }\n\n    /**\n     * Content or scroll has been resized. For content, only call it if it's been added on top.\n     */\n    resizeContent(): void {\n        let top = this.content.getContentDimensions().scrollTop;\n        this.content.resize();\n\n        // Wait for new content height to be calculated.\n        setTimeout(() => {\n            // Visible content size changed, maintain the bottom position.\n            if (!this.viewDestroyed && this.content && this.domUtils.getContentHeight(this.content) != this.oldContentHeight) {\n                if (!top) {\n                    top = this.content.getContentDimensions().scrollTop;\n                }\n\n                top += this.oldContentHeight - this.domUtils.getContentHeight(this.content);\n                this.oldContentHeight = this.domUtils.getContentHeight(this.content);\n\n                this.content.scrollTo(0, top, 0);\n            }\n        });\n    }\n\n    /**\n     * Page destroyed.\n     */\n    ngOnDestroy(): void {\n        this.onlineObserver && this.onlineObserver.unsubscribe();\n        this.keyboardObserver && this.keyboardObserver.off();\n        this.stopPolling();\n        this.viewDestroyed = true;\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/addon/mod/chat/pages/chat/chat.ts"],"sourceRoot":""}